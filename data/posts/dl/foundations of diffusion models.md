---
title: å‚»å­ä¹Ÿèƒ½çœ‹æ‡‚çš„Diffusion Modelsæ•°å­¦åŸºç¡€(1)
subtitle: æ•°å­¦è‹¦æ‰‹åšä¸»çš„åŒ å¿ƒä¹‹ä½œğŸ˜¼ æˆ‘éƒ½èƒ½æ‡‚ç›¸ä¿¡ä½ ä¹Ÿè¡ŒğŸ¤²
date: 2023-11-23 22:00:00
---

> [!abstract] æ€»ç»“
>
> æœ¬ç¯‡æ–‡ç« ä»‹ç»äº†æ‰©æ•£æ¨¡å‹çš„æ•°å­¦åŸç†ï¼ˆDDPMï¼‰

# å‰è¨€

åœ¨å­¦ä¹ Diffusion Modelçš„æ—¶å€™ï¼Œæœ€å›°éš¾çš„éƒ¨åˆ†å°±æ˜¯æ•°å­¦æ¨å¯¼ã€‚è‘—åçš„å¼€å±±ä¹‹ä½œDDPMä¸­çš„æ•°å­¦æ¨å¯¼è·³æ­¥å¾ˆå¤šï¼Œéå¸¸æ™¦æ¶©ã€‚è¿™ä¿ƒæˆäº†æœ¬æ–‡çš„è¯ç”Ÿã€‚

æœ¬ç¯‡æ–‡ç« ä¼šä»¥æœ€é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è¯¦ç»†æ¨å¯¼DMçš„æ•°å­¦åŸç†ï¼Œä¹‹åçš„æ–‡ç« ä¼šè®²è¿°SDMç­‰è¡ç”Ÿæ¨¡å‹çš„åŸç†ï¼Œæ¬¢è¿æŒ‡æ­£ï¼


# DDPM: Denoising Diffusion Probalilistic Model

ç”¨$x_0$è¡¨ç¤ºçœŸå®æ•°æ®ï¼Œè¿™æ˜¯ä»ä¸€ä¸ªåˆ†å¸ƒ$q(x_0)$ä¸­é‡‡æ ·çš„ç»“æœ

$\epsilon_0\sim N(0,I)$ æ˜¯ä»é«˜æ–¯åˆ†å¸ƒé‡‡æ ·å‡ºçš„å™ªéŸ³

## å‰å‘è¿‡ç¨‹

å‘$x_0$ä¸­æ·»åŠ å™ªéŸ³ï¼Œæ­¤æ—¶å¼•å…¥ä¸€ç»„å‚æ•°$\{\beta_t\}$ $\beta_t$æ˜¯ä¸æ—¶é—´æœ‰å…³çš„è¶…å‚æ•°ï¼Œdiffusionç›¸å…³å®ç°ä¸­çš„schedulerå°±æ˜¯ç”¨äºå¾—åˆ°è¿™ç»„å‚æ•°çš„

ç°åœ¨$\beta_t$è¡¨ç¤ºäº†å™ªéŸ³çš„å æ¯”ï¼Œéšç€æ—¶é—´å¢åŠ ï¼Œå™ªéŸ³çš„æ¯”ä¾‹åº”è¯¥è¶Šæ¥è¶Šå¤§

è¿™å’Œæ‰©æ•£ç°è±¡ä¸€è‡´ï¼Œéšç€æ—¶é—´å¢é•¿ï¼Œæ•£å¼€çš„è¶Šæ¥è¶Šå¿«



æ‰€ä»¥æˆ‘ä»¬è¡¨ç¤ºä¸€æ­¥å¢åŠ å™ªéŸ³ä¸ºï¼š

$$x_{t}=\sqrt{1-\beta_{t}}x_{t-1}+\sqrt{\beta_t}\epsilon_{t-1}$$

> [!question] ä½ å¯èƒ½ä¼šé—®
>
> ä¸ºä»€ä¹ˆè¿™é‡Œè¦åŠ æ ¹å·ï¼Ÿ
>
> å› ä¸ºæˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸ªå‚æ•°ä¼šä»¤æ–¹å·®å‘ç”Ÿå¹³æ–¹å€çš„å˜åŒ–ï¼Œè¿™é‡ŒåŠ æ ¹å·åˆ©äºåç»­åŒ–ç®€

å¯¹äºåŠ å™ªéŸ³çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é‡å‚æ•°åŒ–æŠ€å·§ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªå¼å­ï¼š

ä¸ºäº†æ–¹ä¾¿åŒ–ç®€ ä»¤$\alpha_t=1-\beta_t$

$$x_{t}=\sqrt{1-\beta_{t}}x_{t-1}+\sqrt{\beta_t}\epsilon_{t-1}$$

$$=\sqrt{\alpha_{t}}x_{t-1}+\sqrt{1-\alpha_t}\epsilon_{t-1}$$

$$=\sqrt{\alpha_t}(\sqrt{\alpha_{t-1}}x_{t-2}+\sqrt{1-\alpha_{t-1}}\epsilon_{t-2})+\sqrt{1-\alpha_t}\epsilon_{t-1}$$

$$=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+\sqrt{1-\alpha_t\alpha_{t-1}}\epsilon_{t-2}$$

......

$\sqrt{\alpha_t...\alpha_1}x_0+\sqrt{1-(\alpha_t...\alpha_1)}x_1$

ä»¤$\overline{\alpha_t}=\prod_1^t\alpha_i$

$x_t=\sqrt{\overline{\alpha_t}}x_0+\sqrt{1-\overline{\alpha_t}}\epsilon$

æ‰€ä»¥æœä»çš„åˆ†å¸ƒæ˜¯

$q(x_t|x_0)=\mathcal{N}(x_t;\sqrt{\overline{\alpha_t}}x_0),\sqrt{1-\overline{\alpha_t}}I$

## åå‘è¿‡ç¨‹

åå‘è¿‡ç¨‹æ˜¯ç»™å®š$x_t$ï¼Œé¢„æµ‹$x_{t-1}$

æ ¹æ®è´å¶æ–¯å…¬å¼

$q(x_{t-1}|x_t,x_0)=\frac{q(x_{t-1}|x_0)}{q(x_t|x_0)}q(x_t|x_{t-1},x_0)$

ä¸€ä¸ªä¸€ä¸ªçœ‹ï¼š

$q(x_{t-1}|x_0)\sim \mathcal{N}(\sqrt{\overline{\alpha_{t-1}}}x_0, 1-\overline{\alpha_{t-1}})$

$q(x_{t}|x_0)\sim \mathcal{N}(\sqrt{\overline{\alpha_{t}}}x_0, 1-\overline{\alpha_{t}})$

$q(x_t|x_{t-1},x_0)\sim\mathcal{N}(\sqrt{\alpha_{t}}x_{t-1}, 1-\alpha_t)$

ç›´æ¥ç®— æŠŠé«˜æ–¯åˆ†å¸ƒå±•å¼€ å› ä¸ºæˆ‘ä»¬æƒ³è¦å¾—åˆ°å‡å€¼ æ‰€ä»¥å¯ä»¥åªå…³æ³¨æŒ‡æ•°

$q(x_{t-1}|x_t,x_0)\propto exp\{-\frac{1}{2}(\frac{(x_{t-1}-\sqrt{\overline{\alpha_{t-1}}}x_0)^2}{1-\overline{\alpha_{t-1}}}+\frac{(x_{t}-\sqrt{\alpha_{t}}x_{t-1})^2}{1-\alpha_t}-\frac{(x_{t}-\sqrt{\overline{\alpha_{t}}}x_0)^2}{1-\overline{\alpha_{t}}})\}$

ç›®çš„æ˜¯åœ¨åˆ†å­é…æ–¹é…å‡ºæ¥$(x_{t-1}-\hat{\mu})^2$ $x_0$å’Œ$x_t$å½“æˆå‚æ•°

é…å‡ºæ¥çš„ç»“æœæ˜¯ï¼š

$\mu(x_t,t)=\frac{1-\overline{\alpha_{t-1}}}{1-\overline{\alpha_t}}\sqrt{\alpha_t}x_t+\frac{\sqrt{\overline{\alpha_{t-1}}}\beta_t}{1-\overline{\alpha_t}}x_0$

å› ä¸º$x_0$å¯ä»¥ç”¨$x_t$è¡¨ç¤ºï¼ˆå‰é¢çš„å‰å‘åŠ å™ªå…¬å¼ï¼‰

æ‰€ä»¥è¿™ä¸ªå‡å€¼å¯ä»¥è¡¨ç¤ºä¸º

$\mu(x_t,t)=\frac{1}{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha_t}}}\epsilon(x_t,t))$

å¥½å¥½å¥½ è¿™ä¸ªå¼å­é‡Œé¢åªæœ‰ä¸€ä¸ªå€¼æ˜¯æˆ‘ä»¬ä¸çŸ¥é“çš„ğŸ¥³ é‚£å°±æ˜¯$\epsilon(x_t,t)$  è¿™ä¸ªæµ“çœ‰å¤§çœ¼çš„å®¶ä¼™æ˜¯å‰å‘è¿‡ç¨‹ä¸­åŠ å…¥çš„å™ªå£°

<br/>

æ€ä¹ˆå¾—åˆ°è¿™ä¸ªå™ªå£°ï¼Ÿ

æˆ‘ä»¬æ„é€ ä¸€ä¸ªç¥ç»ç½‘ç»œæ¥é¢„æµ‹ä»–ï¼Œå› æ­¤$\epsilon$å˜ä¸º$\epsilon_\theta$ï¼Œground truthæ˜¯å‰å‘è¿‡ç¨‹æ·»åŠ çš„å™ªå£°

è¿™ä¸ªç¥ç»ç½‘ç»œçš„æŸå¤±å‡½æ•°æ˜¯ï¼š

$$||\epsilon-\epsilon_\theta(\sqrt{\overline{\alpha_t}}x_0+\sqrt{1-\overline{\alpha_t}}\epsilon,t)||$$

<br />

è€Œæˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„ $\hat x_{t-1}$ æœä»ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œå…¶å‡å€¼ä¸ºï¼š

$\mu_\theta(x_t,t)=\frac{1}{\sqrt{\alpha_t}}(x_t-\frac{\beta_t}{\sqrt{1-\overline{\alpha_t}}}\epsilon_\theta(x_t,t))$ 
